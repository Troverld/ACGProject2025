任务如下：


### Topic 1: Image Rendering

In this section, you are required to implement a renderer, which can be either hardware-based (GPU) or software-based (CPU). The goal is to produce a static image. Note that a path-tracing renderer is required, as rasterization-based renderers will not be accepted. Also, there is a framework that you can choose to use it or not (github.com/LazyJazzDev/Sparks). The functionalities you need to implement are as follows:

**Core Requirements:**

*   **Base**: Implement a path tracing algorithm that correctly handles **diffuse** and **specular** materials. (basic)
*   **Scene creation**: Build a custom scene with aesthetic considerations, using geometry that you create from scratch or find online (ensure the source is credited). (basic, tidiness and attractiveness 1pt)
*   **Acceleration structure**: Implement an acceleration structure such as BVH (Bounding Volume Hierarchy). This is not required for hardware-based renderers, as the acceleration structure is built-in in that case. (basic, Surface Area Heuristic or another advanced algorithm 2pts)

**Advanced Features (Optional):**

*   **Material:** Create a (non-trivial) custom material. Options include:
    *   Transmissive material (basic)
    *   Principled BSDF (2pts)
    *   Multi-layer material (2pts)
    *   Rendering of fur, hair, skin, etc. (2pts)

*   **Texture:** Create your own (non-trivial) texture with proper texture mapping. Options include:
    *   Color texture (basic)
    *   Normal map, height map, attribute map, or any functional texture mapping (1pt for each, up to 2pts)
    *   Implement an adaptive mipmap algorithm (2pts)

*   **Importance Sampling:** Use more advanced sampling algorithms for path tracing. (Importance sampling with Russian Roulette, multiple importance sampling 2pts)

*   **Volumetric Rendering:** Options include:
    *   Subsurface scattering (2pts)
    *   Homogeneous volume rendering (1pt)
    *   Inhomogeneous volume rendering (1pt)
    *   Channel-independent subsurface scattering (1pt)
    *   Volumetric emission (1pt)
    *   Volumetric alpha shadow (2pts)

*   **Special Visual Effects:** Options include:
    *   Motion blur, depth of field (basic)
    *   Alpha shadow (basic)
    *   Cartoon style rendering (2pts)
    *   Chromatic dispersion (2pts)

*   **Lighting:** Options include:
    *   Point light and area light (basic)
    *   Environment lighting with HDR, such as skybox (2pts)

*   **Anti-aliasing:** Implement an anti-aliasing algorithm (basic)

*   **Simulation-based content creation:** Up to 2pts

目前的代码结构规划如下（可能改动）：

MyPathTracer/
├── CMakeLists.txt                // 构建系统
├── external/                     // 第三方库
│   ├── stb_image.h               // 图像加载
│   ├── stb_image_write.h         // 图像输出
│   └── tiny_obj_loader.h         // 模型加载
├── src/  
│   ├── main.cpp                  // 程序入口，包含渲染循环
│   ├── scene_list.cpp            // 硬编码的场景定义 (Scene 1-5)
│   ├── core/                     // 核心工具
│   │   ├── loader_impl.cpp       // 第三方库的实现宏定义
│   │   ├── ray.hpp               // 光线 (支持时间t)
│   │   ├── onb.hpp               // 正交基 (TBN)
│   │   ├── photon.hpp            // 光子结构体
│   │   ├── record.hpp            // HitRecord 和 ScatterRecord
│   │   └── utils.hpp             // 数学常量、随机数、工具函数
│   ├── scene/                    // 场景管理
│   │   ├── scene.hpp             // 场景容器 (Objects, Lights, BVH)
│   │   └── camera.hpp            // 相机 (支持景深、运动模糊)
│   ├── object/                   // 几何体
│   │   ├── object_utils.hpp      // Object 基类
│   │   ├── object_agg.hpp        // 聚合头文件
│   │   ├── sphere.hpp            // 球体
│   │   ├── moving_sphere.hpp     // 运动球体 (支持 Motion Blur)
│   │   ├── triangle.hpp          // 三角形 (支持平滑着色)
│   │   ├── mesh.hpp              // 网格 (加载 .obj，内部含 BVH)
│   │   └── volume.hpp            // 恒定介质 (ConstantMedium)
│   ├── light/                    // 灯光系统
│   │   ├── light_utils.hpp       // Light 基类
│   │   ├── light_agg.hpp         // 聚合头文件
│   │   ├── pointlight.hpp        // 点光源
│   │   ├── arealight.hpp         // 面光源 (包装 Object)
│   │   └── envirlight.hpp        // 环境光 (支持 HDR)
│   ├── accel/                    // 加速结构
│   │   ├── AABB.hpp              // 轴对齐包围盒
│   │   ├── kdtree.hpp            // 光子映射用的 KD-Tree
│   │   └── BVH.hpp               // 场景/网格用的 BVH
│   ├── material/                 // 材质
│   │   ├── material_utils.hpp    // Material 基类
│   │   ├── material_agg.hpp      // 聚合头文件
│   │   ├── diffuse.hpp           // Lambertian (支持法线贴图)
│   │   ├── metal.hpp             // Metal
│   │   ├── glass.hpp             // Dielectric (折射/反射)
│   │   ├── emitter.hpp           // DiffuseLight (自发光)
│   │   └── isotropic_phase.hpp    // Isotropic (体渲染相函数)
│   ├── texture/                  // 纹理
│   │   ├── texture_utils.hpp     // Texture 基类
│   │   ├── texture_agg.hpp       // 聚合头文件
│   │   ├── solid_color.hpp       // 纯色
│   │   ├── checker.hpp           // 棋盘格
│   │   ├── image_texture.hpp     // 图片纹理 (支持 bilinear插值)
│   │   └── perlin.hpp            // 柏林噪声 (大理石纹路)
│   └── renderer/                 // 渲染核心
│       ├── integrator_utils.hpp  // Integrator 基类 (含 NEE 逻辑)
│       ├── path_integrator.hpp   // 路径追踪 (MIS + RR)
│       └── photon_integrator.hpp // 光子映射 (Caustics + Global)

目前的约定如下：

所有的定义前面都要有英文编写的接口介绍。

所有的文件和文件夹，如果不是某种简写（如 AABB），都要小写。

所有的自定义类型都要遵照 Camel Case。所有的自定义函数都要遵照 Snake Case。

这份文件应该是编写整个项目的核心指导思想。